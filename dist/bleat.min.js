/* @license
 *
 * BLE Abstraction Tool: core functionality
 * Version: 0.0.14
 *
 * The MIT License (MIT)
 *
 * Copyright (c) 2015 Rob Moran
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */
!function(a,b){"function"==typeof define&&define.amd?define(b):"object"==typeof exports?module.exports=b():a.bleat=b()}(this,function(){"use strict";function a(a){return function(b){f&&f(a+": "+b)}}function b(a){return function(){if("function"==typeof a){var b=[].slice.call(arguments);a.apply(this,b)}}}function c(a){var b=0,c=!1;this.addCallback=function(d){return b++,c=!0,function(){d&&d.apply(null,arguments),0===--b&&a&&a()}},this.finish=function(){!c&&a&&a()}}var d=null,e={},f=null,g=function(a,b,c){this.address=a,this.name=b,this.serviceUUIDs=c,this.connected=!1,this.services={}};g.prototype.hasService=function(a){var b=!1;return this.serviceUUIDs.some(function(c){return c===a?(b=!0,!0):void 0}),b},g.prototype.connect=function(c,e,f){d.connect(this,function(){return this.connected=!0,f?b(c)():void this.discoverAll(c)}.bind(this),function(){this.connected=!1,this.services={},b(e)()}.bind(this),a("connect error"))},g.prototype.disconnect=function(){d.disconnect(this,a("disconnect error"))},g.prototype.discoverServices=function(c){return this.connected===!1?a("discovery error")("device not connected"):void d.discoverServices(this,b(c),a("service discovery error"))},g.prototype.discoverAll=function(b){if(this.connected===!1)return a("discovery error")("device not connected");var d=new c(b);this.discoverServices(d.addCallback(function(){Object.keys(this.services).forEach(function(a){var b=this.services[a];b.discoverCharacteristics(d.addCallback(function(){Object.keys(b.characteristics).forEach(function(a){var c=b.characteristics[a];c.discoverDescriptors(d.addCallback())},this)}.bind(this)))},this)}.bind(this))),d.finish()};var h=function(a,b,c){this._handle=a,this.uuid=b,this.primary=c,this.characteristics={}};h.prototype.discoverCharacteristics=function(c){d.discoverCharacteristics(this,b(c),a("characteristic discovery error"))};var i=function(a,b,c){this._handle=a,this.uuid=b,this.properties=c,this.descriptors={}};i.prototype.read=function(c){d.readCharacteristic(this,b(c),a("read characteristic error"))},i.prototype.write=function(c,e){d.writeCharacteristic(this,c,b(e),a("write characteristic error"))},i.prototype.enableNotify=function(c,e){d.enableNotify(this,b(c),b(e),a("enable notify error"))},i.prototype.disableNotify=function(c){d.disableNotify(this,b(c),a("disable notify error"))},i.prototype.discoverDescriptors=function(c){d.discoverDescriptors(this,b(c),a("descriptor discovery error"))};var j=function(a,b){this._handle=a,this.uuid=b};return j.prototype.read=function(c){d.readDescriptor(this,b(c),a("read descriptor error"))},j.prototype.write=function(c,e){d.writeDescriptor(this,c,b(e),a("write descriptor error"))},{raiseError:function(a){f&&f(a)},addAdapter:function(a,b){e[a]=b,d=b},init:function(c,g,h){return f=g,h&&(d=e[h]),d?void d.init(b(c),a("init error")):a("init error")("adapter not found")},startScan:function(b){d.stop(a("stop scan error"));var c={};d.scan(function(a){c[a.address]||(c[a.address]=a,b&&b(a))}.bind(this),a("scan error"))},stopScan:function(){d.stop(a("stop scan error"))},Device:g,Service:h,Characteristic:i,Descriptor:j}}),/* @license
 *
 * BLE Abstraction Tool: chromeos adapter
 * Version: 0.0.7
 *
 * The MIT License (MIT)
 *
 * Copyright (c) 2015 Rob Moran
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */
function(a,b){"function"==typeof define&&define.amd?define(["bleat.core"],b.bind(this,a.chrome)):"object"==typeof exports?module.exports=b(a.chrome,require("./bleat.core")):b(a.chrome,a.bleat)}(this,function(a,b){"use strict";function c(b,c){return function(){if(a.runtime.lastError)return void b(a.runtime.lastError.message);if("function"==typeof c){var d=[].slice.call(arguments);c.apply(this,d)}}}a&&a.bluetooth&&a.bluetoothLowEnergy&&b.addAdapter("chromeos",{charNotifies:{},deviceDisconnects:{},foundFn:null,init:function(d,e){a.bluetooth.getAdapterState(c(e,function(c){c.available?(a.bluetooth.onDeviceAdded.addListener(function(a){if(this.foundFn){var c=new b.Device(a.address,a.name,a.uuids||[]);this.foundFn(c)}}.bind(this)),a.bluetoothLowEnergy.onCharacteristicValueChanged.addListener(function(a){"function"==typeof this.charNotifies[a.instanceId]&&(this.charNotifies[a.instanceId](a.value),delete this.charNotifies[a.instanceId])}.bind(this)),a.bluetooth.onDeviceRemoved.addListener(this.checkDisconnect.bind(this)),a.bluetooth.onDeviceChanged.addListener(function(a){a.connected===!1&&this.checkDisconnect(a)}.bind(this)),d()):e("adapter not enabled")}.bind(this)))},checkDisconnect:function(a){"function"==typeof this.deviceDisconnects[a.address]&&(this.deviceDisconnects[a.address](),delete this.deviceDisconnects[a.address])},scan:function(d,e){a.bluetooth.getDevices(c(e,function(a){a.forEach(function(a){var c=new b.Device(a.address,a.name,a.uuids||[]);d(c)})})),this.foundFn=d,a.bluetooth.startDiscovery(c(e))},stop:function(b){this.foundFn=null,a.bluetooth.discovering&&a.bluetooth.stopDiscovery(c(b))},connect:function(b,d,e,f){a.bluetoothLowEnergy.connect(b.address,c(f,function(){this.deviceDisconnects[b.address]=e,d()}.bind(this)))},disconnect:function(b,d){a.bluetoothLowEnergy.disconnect(b.address,c(d))},discoverServices:function(d,e,f){a.bluetoothLowEnergy.getServices(d.address,c(f,function(a){a.forEach(function(a){var c=new b.Service(a.instanceId,a.uuid,a.isPrimary);d.services[c.uuid]=c}),e()}))},discoverCharacteristics:function(d,e,f){a.bluetoothLowEnergy.getCharacteristics(d._handle,c(f,function(a){a.forEach(function(a){var c=new b.Characteristic(a.instanceId,a.uuid,a.properties);d.characteristics[c.uuid]=c}),e()}))},discoverDescriptors:function(d,e,f){a.bluetoothLowEnergy.getDescriptors(d._handle,c(f,function(a){a.forEach(function(a){var c=new b.Descriptor(a.instanceId,a.uuid);d.descriptors[c.uuid]=c}),e()}))},readCharacteristic:function(b,d,e){a.bluetoothLowEnergy.readCharacteristicValue(b.handle,c(e,function(a){d(a.value)}))},writeCharacteristic:function(b,d,e,f){a.bluetoothLowEnergy.writeCharacteristicValue(b.handle,d.buffer,c(f,e))},enableNotify:function(b,d,e,f){a.bluetoothLowEnergy.startCharacteristicNotifications(b.handle,null,c(f,function(){this.charNotifies[b.handle]=d,e()}.bind(this)))},disableNotify:function(b,d,e){a.bluetoothLowEnergy.stopCharacteristicNotifications(b.handle,c(e,function(){this.charNotifies[b.handle]&&delete this.charNotifies[b.handle],d()}.bind(this)))},readDescriptor:function(b,d,e){a.bluetoothLowEnergy.readDescriptorValue(b.handle,c(e,function(a){d(a.value)}))},writeDescriptor:function(b,d,e,f){a.bluetoothLowEnergy.writeDescriptorValue(b.handle,d.buffer,c(f,e))}})}),/* @license
 *
 * BLE Abstraction Tool: evothings adapter
 * Version: 0.0.7
 *
 * The MIT License (MIT)
 *
 * Copyright (c) 2015 Rob Moran
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */
function(a,b){"function"==typeof define&&define.amd?define(["bleat.core"],b.bind(this,a.cordova,a)):"object"==typeof exports?module.exports=b(a.cordova,a,require("./bleat.core")):b(a.cordova,a,a.bleat)}(this,function(a,b,c){"use strict";function d(a){return a>64&&91>a?a-65:a>96&&123>a?a-71:a>47&&58>a?a+4:43===a?62:47===a?63:0}function e(a,b){for(var c,e,f=a.replace(/[^A-Za-z0-9\+\/]/g,""),g=f.length,h=b?Math.ceil((3*g+1>>2)/b)*b:3*g+1>>2,i=new Uint8Array(h),j=0,k=0,l=0;g>l;l++)if(e=3&l,j|=d(f.charCodeAt(l))<<18-6*e,3===e||g-l===1){for(c=0;3>c&&h>k;c++,k++)i[k]=j>>>(16>>>c&24)&255;j=0}return i}function f(a,b){return(a[b+1]<<8)+a[b]}function g(a,b){return(a[b+3]<<24)+(a[b+2]<<16)+(a[b+1]<<8)+a[b]}function h(a,b){var c="",d=0;return[4,2,2,2,6].forEach(function(e){c+="-";for(var f=0;e>f;f++,d++)c+=("00"+a[b+d].toString(16)).slice(-2)}),c.substr(1)}function i(a){var b={name:a.name,serviceUUIDs:[]};if(a.advertisementData)a.advertisementData.kCBAdvDataLocalName&&(b.name=a.advertisementData.kCBAdvDataLocalName),a.advertisementData.kCBAdvDataServiceUUIDs&&a.advertisementData.kCBAdvDataServiceUUIDs.forEach(function(a){a.length>8?b.serviceUUIDs.push(a.toLowerCase()):b.serviceUUIDs.push(("00000000"+a.toLowerCase()).slice(-8)+j)});else if(a.scanRecord)for(var c=e(a.scanRecord),d=0;d<c.length;){var i=c[d++];if(0===i)break;i-=1;var k,l=c[d++];if(2==l||3==l)for(k=0;i>k;k+=2)b.serviceUUIDs.push(("0000"+f(c,d+k).toString(16)).slice(-8)+j);else if(4==l||5==l)for(k=0;i>k;k+=4)b.serviceUUIDs.push(("00000000"+g(c,d+k).toString(16)).slice(-8)+j);else if(6==l||7==l)for(k=0;i>k;k+=4)b.serviceUUIDs.push(h(c,d+k));else(8==l||9==l)&&(b.name=evothings.ble.fromUtf8(new Uint8Array(c.buffer,d,i)).replace("\x00",""));d+=i}return b}var j="-0000-1000-8000-00805f9b34fb",k="00002902-0000-1000-8000-00805f9b34fb";if(a){var l=a.platformId;c.addAdapter("evothings",{deviceHandles:{},serviceHandles:{},characteristicHandles:{},descriptorHandles:{},notifyCallbacks:{},init:function(a,c){b.evothings&&evothings.ble?a():document.addEventListener("deviceready",a)},scan:function(a,b){evothings.ble.startScan(function(b){var d=i(b),e=new c.Device(b.address,d.name,d.serviceUUIDs);a(e)},b)},stop:function(a){evothings.ble.stopScan()},connect:function(a,b,c,d){evothings.ble.connect(a.address,function(d){0===d.state?(this.deviceHandles[a.address]&&(evothings.ble.close(this.deviceHandles[a.address]),delete this.deviceHandles[a.address]),c()):2===d.state&&(this.deviceHandles[a.address]=d.deviceHandle,b())}.bind(this),d)},disconnect:function(a,b){this.deviceHandles[a.address]&&evothings.ble.close(this.deviceHandles[a.address])},discoverServices:function(a,b,d){var e=this.deviceHandles[a.address];evothings.ble.services(e,function(d){d.forEach(function(b){this.serviceHandles[b.handle]=e;var d=new c.Service(b.handle,b.uuid,0===b.type);a.services[d.uuid]=d},this),b()}.bind(this),d)},discoverCharacteristics:function(a,b,d){var e=this.serviceHandles[a._handle];evothings.ble.characteristics(e,a._handle,function(d){d.forEach(function(b){this.characteristicHandles[b.handle]=e;var d=[],f=new c.Characteristic(b.handle,b.uuid,d);a.characteristics[f.uuid]=f},this),b()}.bind(this),d)},discoverDescriptors:function(a,b,d){var e=this.characteristicHandles[a._handle];evothings.ble.descriptors(e,a._handle,function(d){d.forEach(function(b){this.descriptorHandles[b.handle]=e;var d=new c.Descriptor(b.handle,b.uuid);a.descriptors[d.uuid]=d},this),b()}.bind(this),d)},readCharacteristic:function(a,b,c){evothings.ble.readCharacteristic(this.characteristicHandles[a._handle],a._handle,function(d){"ios"===l&&this.notifyCallbacks[a.uuid]&&this.enableNotify(a,this.notifyCallbacks[a.uuid],null,c),b(d)}.bind(this),c)},writeCharacteristic:function(a,b,c,d){evothings.ble.writeCharacteristic(this.characteristicHandles[a._handle],a._handle,b,c,d)},enableNotify:function(a,b,c,d){var e=function(){evothings.ble.enableNotification(this.characteristicHandles[a._handle],a._handle,b,d),"ios"===l&&(this.notifyCallbacks[a.uuid]=b),c&&c()};if("android"===l){var f=a.descriptors[k];if(!f)return void d("cannot find notify descriptor");this.writeDescriptor(f,new Uint8Array([1,0]),e.bind(this),d)}else e.call(this)},disableNotify:function(a,b,c){evothings.ble.disableNotification(this.characteristicHandles[a._handle],a._handle,b,c),"ios"===l&&(delete this.notifyCallbacks[a.uuid],b())},readDescriptor:function(a,b,c){evothings.ble.readDescriptor(this.descriptorHandles[a._handle],a._handle,b,c)},writeDescriptor:function(a,b,c,d){evothings.ble.writeDescriptor(this.descriptorHandles[a._handle],a._handle,b,c,d)}})}}),/* @license
 *
 * BLE Abstraction Tool: noble adapter
 * Version: 0.0.3
 *
 * The MIT License (MIT)
 *
 * Copyright (c) 2015 Rob Moran
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */
function(a,b){"function"==typeof define&&define.amd?define(["noble","bleat.core"],b):"object"==typeof exports?module.exports=b(require("noble"),require("./bleat.core")):b(a.noble,a.bleat)}(this,function(a,b){"use strict";function c(a,b){return function(c){if(c)a(c);else if("function"==typeof b){var d=[].slice.call(arguments,1);b.apply(this,d)}}}function d(a){var b="-0000-1000-8000-00805f9b34fb";return a.length>8?a.toLowerCase():("00000000"+a.toLowerCase()).slice(-8)+b}a&&b.addAdapter("noble",{foundFn:null,deviceHandles:{},serviceHandles:{},characteristicHandles:{},descriptorHandles:{},charNotifies:{},init:function(c,e){function f(f){"poweredOn"===f?(a.on("discover",function(a){if(this.foundFn){var c=a.address&&"unknown"!==a.address?a.address:a.uuid;this.deviceHandles[c]=a;var e=[];a.advertisement.serviceUuids.forEach(function(a){e.push(d(a))});var f=new b.Device(c,a.advertisement.localName||c,e);this.foundFn(f)}}.bind(this)),c()):e("adapter not enabled")}"unknown"===a.state?a.once("stateChange",f.bind(this)):f(a.state)},scan:function(b,d){this.foundFn=b,a.startScanning([],!1,c(d))},stop:function(b){a.stopScanning()},connect:function(a,b,d,e){var f=this.deviceHandles[a.address];f.once("connect",b),f.once("disconnect",d),f.connect(c(e))},disconnect:function(a,b){this.deviceHandles[a.address].disconnect(c(b))},discoverServices:function(a,e,f){var g=this.deviceHandles[a.address];g.discoverServices([],c(f,function(c){c.forEach(function(c){this.serviceHandles[c.uuid]=c;var e=d(c.uuid),f=new b.Service(c.uuid,e,!1);a.services[f.uuid]=f},this),e()}.bind(this)))},discoverCharacteristics:function(a,e,f){var g=this.serviceHandles[a._handle];g.discoverCharacteristics([],c(f,function(c){c.forEach(function(c){this.characteristicHandles[c.uuid]=c;var e=d(c.uuid),f=new b.Characteristic(c.uuid,e,c.properties);a.characteristics[f.uuid]=f,c.on("read",function(a,b){if(b===!0&&"function"==typeof this.charNotifies[e]){var c=new Uint8Array(a).buffer;this.charNotifies[e](c)}}.bind(this))},this),e()}.bind(this)))},discoverDescriptors:function(a,e,f){var g=this.characteristicHandles[a._handle];g.discoverDescriptors(c(f,function(c){c.forEach(function(c){var e=g.uuid+"-"+c.uuid;this.descriptorHandles[e]=c;var f=d(c.uuid),h=new b.Descriptor(e,f);a.descriptors[f]=h},this),e()}.bind(this)))},readCharacteristic:function(a,b,d){this.characteristicHandles[a._handle].read(c(d,function(a){var c=new Uint8Array(a).buffer;b(c)}))},writeCharacteristic:function(a,b,d,e){var f=new Buffer(new Uint8Array(b.buffer));this.characteristicHandles[a._handle].write(f,!0,c(e,d))},enableNotify:function(a,b,d,e){this.characteristicHandles[a._handle].once("notify",function(c){return c!==!0?e("notify failed to enable"):(this.charNotifies[a.uuid]=b,void d())}.bind(this)),this.characteristicHandles[a._handle].notify(!0,c(e))},disableNotify:function(a,b,d){this.characteristicHandles[a._handle].once("notify",function(c){return c!==!1?d("notify failed to disable"):(this.charNotifies[a.uuid]&&delete this.charNotifies[a.uuid],void b())}.bind(this)),this.characteristicHandles[a._handle].notify(!1,c(d))},readDescriptor:function(a,b,d){this.descriptorHandles[a._handle].readValue(c(d,function(a){var c=new Uint8Array(a).buffer;b(c)}))},writeDescriptor:function(a,b,d,e){var f=new Buffer(new Uint8Array(b.buffer));this.descriptorHandles[a._handle].writeValue(f,c(e,d))}})});