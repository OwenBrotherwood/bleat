/* @license
 *
 * BLE Abstraction Tool
 * Version: 0.0.8
 *
 * The MIT License (MIT)
 *
 * Copyright (c) 2015 Rob Moran
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */
!function(a,b){"function"==typeof define&&define.amd?define(b):"object"==typeof exports?module.exports=b():a.bleat=b()}(this,function(){"use strict";function a(a){return function(b){e&&e(a+": "+b)}}function b(a){return function(){if("function"==typeof a){var b=[].slice.call(arguments);a.apply(this,b)}}}var c=null,d={},e=null,f=function(a,b,c){this.address=a,this.name=b,this.connected=!1,this.serviceUUIDs=c,this.services={}};f.prototype.hasService=function(a){var b=!1;return this.serviceUUIDs.some(function(c){return c===a?(b=!0,!0):void 0}),b},f.prototype.connect=function(d,e){c.connect(this,b(d),b(e),a("connect error"))},f.prototype.disconnect=function(){c.disconnect(this,a("disconnect error"))};var g=function(a,b,c){this.uuid=a,this.handle=b,this.primary=c,this.characteristics={}},h=function(a,b,c){this.uuid=a,this.handle=b,this.properties=c,this.descriptors={}};h.prototype.read=function(d){c.readCharacteristic(this,b(d),a("read characteristic error"))},h.prototype.write=function(d,e){c.writeCharacteristic(this,d,b(e),a("write characteristic error"))},h.prototype.enableNotify=function(d){c.enableNotify(this,b(d),a("enable notify error"))},h.prototype.disableNotify=function(d){c.disableNotify(this,b(d),a("disable notify error"))};var i=function(a,b){this.uuid=a,this.handle=b};return i.prototype.read=function(d){c.readDescriptor(this,b(d),a("read descriptor error"))},i.prototype.write=function(d,e){c.writeDescriptor(this,d,b(e),a("write descriptor error"))},{raiseError:function(a){e&&e(a)},addAdapter:function(a,b){d[a]=b,c=b},init:function(f,g,h){e=g,h&&(c=d[h]),c?c.init(b(f),a("init error")):a("init error")("adapter not found")},startScan:function(b){c.stop(a("stop scan error"));var d={};c.scan(function(a){d[a.address]||(d[a.address]=a,b&&b(a))}.bind(this),a("scan error"))},stopScan:function(){c.stop(a("stop scan error"))},Device:f,Service:g,Characteristic:h,Descriptor:i}}),/* @license
 *
 * BLE Abstraction Tool: chromeos adapter
 * Version: 0.0.2
 *
 * The MIT License (MIT)
 *
 * Copyright (c) 2015 Rob Moran
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */
function(a,b){"function"==typeof define&&define.amd?define([a,"bleat"],b):"object"==typeof exports?module.exports=b(a,require("bleat")):b(a,a.bleat)}(this,function(a,b){"use strict";function c(a,b){return function(){if(chrome.runtime.lastError)return void a(chrome.runtime.lastError.message);if("function"==typeof b){var c=[].slice.call(arguments);b.apply(this,c)}}}a.chrome&&a.chrome.bluetooth&&a.chrome.bluetoothLowEnergy&&b.addAdapter("chromeos",{charNotifies:{},deviceDisconnects:{},foundFn:null,init:function(a,d){chrome.bluetooth.getAdapterState(c(d,function(c){chrome.bluetooth.onDeviceAdded.addListener(function(a){if(this.foundFn){var c=new b.Device(a.address,a.name,a.uuids||[]);this.foundFn(c)}}),chrome.bluetoothLowEnergy.onCharacteristicValueChanged.addListener(function(a){"function"==typeof this.charNotifies[a.instanceId]&&(this.charNotifies[a.instanceId](a.value),delete this.charNotifies[a.instanceId])}),chrome.bluetooth.onDeviceRemoved.addListener(this.checkDisconnect),chrome.bluetooth.onDeviceChanged.addListener(function(a){a.connected===!1&&checkDisconnect(a)}),c.available?a():d("adapter not enabled")}))},checkDisconnect:function(a){"function"==typeof this.deviceDisconnects[a.address]&&(this.deviceDisconnects[a.address](),delete this.deviceDisconnects[a.address])},scan:function(a,d){chrome.bluetooth.getDevices(c(d,function(c){c.forEach(function(c){var d=new b.Device(c.address,c.name,c.uuids||[]);a(d)})})),this.foundFn=a,chrome.bluetooth.startDiscovery(c(d))},stop:function(a){this.foundFn=null,chrome.bluetooth.stopDiscovery(c(a))},connect:function(a,d,e,f){chrome.bluetoothLowEnergy.connect(a.address,null,c(f,function(){this.deviceDisconnects[a.address]=function(){a.connected=!1,a.services={},e()},a.connected=!0,chrome.bluetoothLowEnergy.getServices(a.address,c(f,function(e){e.forEach(function(d){var e=new b.Service(d.uuid,d.instanceId,d.isPrimary);a.services[e.uuid]=e,chrome.bluetoothLowEnergy.getCharacteristics(e.handle,c(f,function(a){a.forEach(function(a){var d=new b.Characteristic(a.uuid,a.instanceId,a.properties);e.characteristics[d.uuid]=d,chrome.bluetoothLowEnergy.getDescriptors(d.handle,c(f,function(a){a.forEach(function(a){var c=new b.Descriptor(a.uuid,a.instanceId);d.descriptors[c.uuid]=c})}))})}))}),setTimeout(d,0)}))}))},disconnect:function(a,b){chrome.bluetoothLowEnergy.disconnect(a.address,c(b))},readCharacteristic:function(a,b,d){chrome.bluetoothLowEnergy.readCharacteristicValue(a.handle,c(d,function(a){b(a.value)}))},writeCharacteristic:function(a,b,d,e){chrome.bluetoothLowEnergy.writeCharacteristicValue(a.handle,b.buffer,c(e,d))},enableNotify:function(a,b,d){chrome.bluetoothLowEnergy.startCharacteristicNotifications(a.handle,null,c(d,function(){this.charNotifies[a.handle]=b}))},disableNotify:function(a,b,d){chrome.bluetoothLowEnergy.stopCharacteristicNotifications(a.handle,c(d,function(){this.charNotifies[a.handle]&&delete this.charNotifies[a.handle],b()}))},readDescriptor:function(a,b,d){chrome.bluetoothLowEnergy.readDescriptorValue(a.handle,c(d,function(a){b(a.value)}))},writeDescriptor:function(a,b,d,e){chrome.bluetoothLowEnergy.writeDescriptorValue(a.handle,b.buffer,c(e,d))}})}),/* @license
 *
 * BLE Abstraction Tool: evothings adapter
 * Version: 0.0.3
 *
 * The MIT License (MIT)
 *
 * Copyright (c) 2015 Rob Moran
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */
function(a,b){"function"==typeof define&&define.amd?define([a,"bleat"],b):"object"==typeof exports?module.exports=b(a,require("bleat")):b(a,a.bleat)}(this,function(a,b){"use strict";function c(a){return a>64&&91>a?a-65:a>96&&123>a?a-71:a>47&&58>a?a+4:43===a?62:47===a?63:0}function d(a,b){for(var d,e,f=a.replace(/[^A-Za-z0-9\+\/]/g,""),g=f.length,h=b?Math.ceil((3*g+1>>2)/b)*b:3*g+1>>2,i=new Uint8Array(h),j=0,k=0,l=0;g>l;l++)if(e=3&l,j|=c(f.charCodeAt(l))<<18-6*e,3===e||g-l===1){for(d=0;3>d&&h>k;d++,k++)i[k]=j>>>(16>>>d&24)&255;j=0}return i}function e(a,b){return(a[b+1]<<8)+a[b]}function f(a,b){return(a[b+3]<<24)+(a[b+2]<<16)+(a[b+1]<<8)+a[b]}function g(a,b){var c="",d=0;return[4,2,2,2,6].forEach(function(e){c+="-";for(var f=0;e>f;f++,d++)c+=("00"+a[b+d].toString(16)).slice(-2)}),c.substr(1)}function h(a){var b={name:a.name,serviceUUIDs:[]};if(a.advertisementData)a.advertisementData.kCBAdvDataLocalName&&(b.name=a.advertisementData.kCBAdvDataLocalName),a.advertisementData.kCBAdvDataServiceUUIDs&&a.advertisementData.kCBAdvDataServiceUUIDs.forEach(function(a){b.serviceUUIDs.push(a.length>8?a.toLowerCase():("00000000"+a.toLowerCase()).slice(-8)+i)});else if(a.scanRecord)for(var c=d(a.scanRecord),h=0;h<c.length;){var j=c[h++];if(0===j)break;j-=1;var k,l=c[h++];if(2==l||3==l)for(k=0;j>k;k+=2)b.serviceUUIDs.push(("0000"+e(c,h+k).toString(16)).slice(-8)+i);else if(4==l||5==l)for(k=0;j>k;k+=4)b.serviceUUIDs.push(("00000000"+f(c,h+k).toString(16)).slice(-8)+i);else if(6==l||7==l)for(k=0;j>k;k+=4)b.serviceUUIDs.push(g(c,h+k));else(8==l||9==l)&&(b.name=evothings.ble.fromUtf8(new Uint8Array(c.buffer,h,j)));h+=j}return b}var i="-0000-1000-8000-00805f9b34fb";(a.evothings||a.cordova)&&b.addAdapter("evothings",{deviceHandles:{},characteristicHandles:{},descriptorHandles:{},init:function(b,c){a.evothings&&evothings.ble?b():document.addEventListener("deviceready",b)},scan:function(a,c){evothings.ble.startScan(function(c){var d=h(c),e=new b.Device(c.address,d.name,d.serviceUUIDs);a(e)},c)},stop:function(a){evothings.ble.stopScan()},connect:function(a,c,d,e){evothings.ble.connect(a.address,function(f){0===f.state?(a.connected=!1,a.services={},this.deviceHandles[a.address]&&(evothings.ble.close(this.deviceHandles[a.address]),delete this.deviceHandles[a.address]),d()):2===f.state&&(a.connected=!0,this.deviceHandles[a.address]=f.deviceHandle,evothings.ble.readAllServiceData(f.deviceHandle,function(d){d.forEach(function(c){var d=new b.Service(c.uuid,c.handle,0===c.type);a.services[d.uuid]=d,c.characteristics.forEach(function(a){var c=[],e=new b.Characteristic(a.uuid,a.handle,c);d.characteristics[e.uuid]=e,this.characteristicHandles[a.handle]=f.deviceHandle,a.descriptors.forEach(function(a){var c=new b.Descriptor(a.uuid,a.handle);e.descriptors[c.uuid]=c,this.descriptorHandles[a.handle]=f.deviceHandle},this)},this)},this),c()}.bind(this),e))}.bind(this),e)},disconnect:function(a,b){this.deviceHandles[a.address]&&evothings.ble.close(this.deviceHandles[a.address])},readCharacteristic:function(a,b,c){evothings.ble.readCharacteristic(this.characteristicHandles[a.handle],a.handle,b,c)},writeCharacteristic:function(a,b,c,d){evothings.ble.writeCharacteristic(this.characteristicHandles[a.handle],a.handle,b,c,d)},enableNotify:function(a,b,c){evothings.ble.enableNotification(this.characteristicHandles[a.handle],a.handle,b,c)},disableNotify:function(a,b,c){evothings.ble.disableNotification(this.characteristicHandles[a.handle],a.handle,b,c)},readDescriptor:function(a,b,c){evothings.ble.readDescriptor(this.descriptorHandles[a.handle],a.handle,b,c)},writeDescriptor:function(a,b,c,d){evothings.ble.writeDescriptor(this.descriptorHandles[a.handle],a.handle,b,c,d)}})});